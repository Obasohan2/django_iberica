{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}


<!-- Add New Post Button -->
<div class="d-flex justify-content-end mb-3">
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPostModal">
    Add New Post
  </button>
</div>

<!-- Featured Post Hero -->
{% for post in featured_posts %}  
  {% if forloop.first %}     
  <div class="jumbotron p-3 p-md-5 text-white rounded bg-dark" style="background-image: url({{ post.featured_image.url }});background-blend-mode: overlay;background-size:cover;">
      <div class="col-md-8 px-0">
        <h1 class="display-4 font-italic">{{ post.title }}</h1>
        <p class="lead my-3">{{ post.excerpt | truncatewords:15 }}</p>
        <p class="lead mb-0"><a href="#" class="text-white font-weight-bold">Continue reading...</a></p>
      </div>
  </div>
  {% endif %}
{% endfor %}

<!-- Featured Posts with times created -->
<h3 class="text-uppercase text-warning" style="letter-spacing: 2px;">Featured Posts</h3>
<div class="row mb-2">
  {% for post in featured_posts %}
    <div class="col-md-6">
      <div class="card border-0">
        <div class="card-body">
          <h3>{{ post.title }}</h3>
          <small class="mb-1 text-muted">
            {{ post.created_on | timesince }} ago | {{ post.author }} 
          </small>
          <p class="card-text">{{ post.excerpt | truncatewords:30 }}.</p>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

<!-- Normal recent posts/articles -->
<h3 class="text-uppercase text-warning" style="letter-spacing: 2px;">Recent Articles</h3>
<main role="main" class="container p-0">
  <div class="row">
    <div class="col-md-8 blog-main">
      {% for post in posts %}
      <div class="card border-0">
        <div class="card-body">
          <h3>{{ post.title }}</h3>
          <small class="mb-1 text-muted">
            {{ post.created_on | timesince }} ago | {{ post.author }} 
          </small>
          <p class="card-text">{{ post.excerpt | truncatewords:10 }}.</p>
        </div>
      </div>
      {% endfor %}
    </div><!-- /.blog-main -->

    <aside class="col-md-4 blog-sidebar">
      <div class="p-3 mb-3 bg-light rounded">
        <h4 class="font-italic">About</h4>
        <p class="mb-0">Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.</p>
      </div>

      <div class="p-3">
        <h4 class="font-italic">Follow Us</h4>
        <ol class="list-unstyled">
          <li><a href="#">GitHub</a></li>
          <li><a href="#">LinkedIn</a></li>
        </ol>
      </div>
    </aside><!-- /.blog-sidebar -->
  </div><!-- /.row -->
</main><!-- /.container -->

<!-- Add New Post Modal -->
<div class="modal fade" id="addPostModal" tabindex="-1" aria-labelledby="addPostModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="addPostModalLabel">Add New Post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form action="{% url 'add_post' %}" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          {{ form|crispy }}
          <button type="submit" class="btn btn-warning mt-2">Submit</button>
        </form>
      </div>

    </div>
  </div>
</div>

{% endblock %}
