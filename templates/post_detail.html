{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}

<!-- ===================== POST HEADER ===================== -->
<div class="container mt-4">
  <div class="row">
    <div class="col-lg-10 mx-auto text-center">

      <h1 class="post-title mb-2">{{ post.title }}</h1>

      <p class="text-muted">
        {{ post.author }} · {{ post.created_on }}
      </p>

      <!-- ===================== FEATURED IMAGE ===================== -->
      {% if post.featured_image %}
        <img
          src="{{ post.featured_image.url }}"
          class="img-fluid rounded mb-4"
          alt="{{ post.title }}"
          style="max-height: 200px; object-fit: cover;"
        >
      {% else %}
        <img
          src="{% static 'image/blogNews.png' %}"
          class="img-fluid rounded mb-4"
          alt="No image available"
          style="max-height: 200px; object-fit: cover;"
        >
      {% endif %}

    </div>
  </div>
</div>

<!-- ===================== POST CONTENT ===================== -->
<div class="container">
  <div class="row">
    <div class="col-lg-10 mx-auto">

      <div class="card mb-4">
        <div class="card-body">

          <div class="card-text">
            {{ post.content|safe }}
          </div>

          <!-- ===================== LIKES & COMMENTS ===================== -->
          <div class="d-flex align-items-center mt-4">

            <div class="mr-4">
              {% if user.is_authenticated %}
                <form
                  class="d-inline"
                  action="{% url 'post_like' post.slug %}"
                  method="POST"
                >
                  {% csrf_token %}
                  <button
                    type="submit"
                    class="btn p-0 border-0 bg-transparent"
                  >
                    {% if liked %}
                      <i class="fas fa-heart text-danger"></i>
                    {% else %}
                      <i class="far fa-heart text-muted"></i>
                    {% endif %}
                  </button>
                </form>
              {% else %}
                <i class="far fa-heart text-muted"></i>
              {% endif %}

              <span class="text-secondary ml-1">
                {{ post.number_of_likes }}
              </span>
            </div>

            <div>
              <i class="far fa-comments text-muted"></i>
              <span class="text-secondary ml-1">
                {{ comments.count }}
              </span>
            </div>

          </div>

        </div>
      </div>

      <hr>

      <!-- ===================== COMMENTS ===================== -->
      <section class="mb-5">
        <h3 class="mb-4">Comments</h3>

        {% if comments %}
          {% for comment in comments %}
            <div class="border rounded p-3 mb-3">
              <p class="mb-1 font-weight-bold">
                {{ comment.name }}
                <span class="text-muted font-weight-normal">
                  · {{ comment.created_on }}
                </span>
              </p>
              <p class="mb-0">
                {{ comment.body|linebreaks }}
              </p>
            </div>
          {% endfor %}
        {% else %}
          <p class="text-muted">
            No comments yet. Be the first to comment.
          </p>
        {% endif %}
      </section>

      <!-- ===================== COMMENT FORM ===================== -->
      <section class="mb-5">
        {% if commented %}
          <div class="alert alert-success">
            Your comment is awaiting approval.
          </div>
        {% else %}
          {% if user.is_authenticated %}
            <h3>Leave a comment</h3>
            <p class="text-muted">
              Posting as {{ user.username }}
            </p>

            <form method="POST">
              {% csrf_token %}
              {{ comment_form|crispy }}
              <button type="submit" class="btn btn-warning mt-2">
                Submit
              </button>
            </form>
          {% else %}
            <div class="alert alert-info">
              You must be
              <a
                href="{% url 'account_login' %}?next={{ request.path }}"
                class="alert-link"
              >
                logged in
              </a>
              or
              <a
                href="{% url 'account_signup' %}?next={{ request.path }}"
                class="alert-link"
              >
                register
              </a>
              to comment.
            </div>
          {% endif %}
        {% endif %}
      </section>

      <!-- ===================== AUTHOR ACTIONS ===================== -->
      {% if user.is_authenticated and user == post.author %}
        <div class="mb-5">
          <a
            href="{% url 'post_edit' post.pk %}"
            class="btn btn-primary btn-sm"
          >
            <i class="fas fa-edit"></i> Update
          </a>

          <a
            href="{% url 'post_delete' post.pk %}"
            class="btn btn-danger btn-sm"
            onclick="return confirm('Are you sure you want to delete this post?');"
          >
            <i class="fas fa-trash"></i> Delete
          </a>
        </div>
      {% endif %}

    </div>
  </div>
</div>

{% endblock %}
